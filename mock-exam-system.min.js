!function(t){"use strict";function e(e){if("string"!=typeof e)return e;if("base64:"===e.slice(0,7))try{return t.atob(e.slice(7))}catch(t){return e}return e}class i{constructor(t={}){this.reactivationCode=t.reactivationCode||"1234",this.codeTimeout=t.codeTimeout||6e4,this.onViolation=t.onViolation||null,this.onReactivated=t.onReactivated||null,this.onTimeout=t.onTimeout||null,this.violations=[],this.isViolated=!1,this.isFullScreen=!1,this.violationStartTime=null,this.timeoutTimer=null,this.isActive=!1,this.violationOverlay=null,this.init()}init(){this.createViolationOverlay(),this.attachEventListeners()}start(){this.isActive=!0,this.enterFullScreen()}stop(){this.isActive=!1,this.exitFullScreen()}enterFullScreen(){const t=document.documentElement;t.requestFullscreen?t.requestFullscreen().catch((function(){})):t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}exitFullScreen(){document.exitFullscreen?document.exitFullscreen().catch((function(){})):document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}isInFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}attachEventListeners(){window.addEventListener("blur",this.handleWindowBlur.bind(this)),window.addEventListener("focus",this.handleWindowFocus.bind(this)),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),document.addEventListener("fullscreenchange",this.handleFullScreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.handleFullScreenChange.bind(this)),document.addEventListener("msfullscreenchange",this.handleFullScreenChange.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("contextmenu",this.handleContextMenu.bind(this)),document.addEventListener("copy",this.handleCopy.bind(this)),document.addEventListener("paste",this.handlePaste.bind(this)),document.addEventListener("cut",this.handleCut.bind(this))}handleWindowBlur(){this.isActive&&!this.isViolated&&(this.recordViolation("Window focus lost"),this.showViolation("Window Focus Lost","You switched to another window or application"))}handleWindowFocus(){}handleVisibilityChange(){this.isActive&&!this.isViolated&&document.hidden&&(this.recordViolation("Tab switched"),this.showViolation("Tab Switch Detected","You switched to another browser tab"))}handleFullScreenChange(){if(!this.isActive)return;const t=this.isInFullScreen();t||this.isViolated||(this.recordViolation("Exited full screen"),this.showViolation("Full Screen Exited","You exited full screen mode")),this.isFullScreen=t}handleKeyDown(t){if(!this.isActive)return;return[t.altKey&&"Tab"===t.key,t.ctrlKey&&t.shiftKey&&"Escape"===t.key,t.metaKey&&"Tab"===t.key,"F11"===t.key,"F12"===t.key,t.ctrlKey&&"w"===t.key,t.ctrlKey&&"t"===t.key,t.ctrlKey&&t.shiftKey&&"N"===t.key,t.altKey&&"F4"===t.key,t.ctrlKey&&t.shiftKey&&("I"===t.key||"J"===t.key||"C"===t.key),t.ctrlKey&&("u"===t.key||"U"===t.key),t.metaKey&&t.altKey&&("I"===t.key||"J"===t.key||"U"===t.key||"C"===t.key)].some((function(t){return t}))?(t.preventDefault(),t.stopPropagation(),!1):void 0}handleContextMenu(t){if(this.isActive)return t.preventDefault(),!1}handleCopy(t){if(this.isActive)return t.preventDefault(),!1}handlePaste(t){if(this.isActive)return t.preventDefault(),!1}handleCut(t){if(this.isActive)return t.preventDefault(),!1}recordViolation(t){const e={type:t,timestamp:(new Date).toISOString(),timeString:(new Date).toLocaleString()};this.violations.push(e),this.onViolation&&this.onViolation(e,this.violations)}showViolation(t,e){if(!this.isViolated){this.isViolated=!0,this.violationStartTime=Date.now(),document.body.style.backgroundColor="#000",document.body.style.color="#fff",this.violationOverlay.style.display="flex";var i=this.violationOverlay.querySelector(".violation-title"),n=this.violationOverlay.querySelector(".violation-message"),o=this.violationOverlay.querySelector(".violation-code-input"),a=this.violationOverlay.querySelector(".violation-timer");i.textContent=t,n.textContent=e,o.value="",o.focus(),this.startCountdown(a)}}hideViolation(){this.isViolated=!1,this.violationStartTime=null,this.timeoutTimer&&(clearInterval(this.timeoutTimer),this.timeoutTimer=null),document.body.style.backgroundColor="",document.body.style.color="",this.violationOverlay.style.display="none",this.isActive&&this.enterFullScreen()}startCountdown(t){var e=this;function i(){if(e.isViolated){var i=Math.max(0,e.codeTimeout-(Date.now()-e.violationStartTime));t.textContent="Time remaining: "+Math.ceil(i/1e3)+"s",i<=0&&(clearInterval(e.timeoutTimer),e.handleTimeout())}else e.timeoutTimer&&(clearInterval(e.timeoutTimer),e.timeoutTimer=null)}i(),this.timeoutTimer=setInterval(i,100)}handleTimeout(){var t=this.violationOverlay.querySelector(".violation-error"),e=this.violationOverlay.querySelector(".violation-code-input"),i=this.violationOverlay.querySelector(".violation-submit-btn");t.textContent="Time expired! Test session terminated.",t.style.display="block",e.disabled=!0,i.disabled=!0,this.isActive=!1,this.onTimeout&&this.onTimeout(this.violations)}verifyCode(t){return t===this.reactivationCode}handleCodeSubmit(){var t=this.violationOverlay.querySelector(".violation-code-input"),e=this.violationOverlay.querySelector(".violation-error"),i=(t.value||"").trim();this.verifyCode(i)?(e.style.display="none",this.hideViolation(),this.onReactivated&&this.onReactivated(this.violations)):(e.textContent="Invalid reactivation code. Please try again.",e.style.display="block",t.value="",t.focus())}createViolationOverlay(){var t=document.createElement("div");t.className="proctoring-violation-overlay",t.innerHTML='<div class="violation-container"><div class="violation-icon">!</div><h2 class="violation-title">Violation Detected</h2><p class="violation-message">A proctoring violation has been detected.</p><div class="violation-details"><p class="violation-timer">Time remaining: 60s</p><p class="violation-instruction">Enter the reactivation code to continue:</p></div><div class="violation-input-group"><input type="password" class="violation-code-input" placeholder="Enter reactivation code" maxlength="20" autocomplete="off" /><button class="violation-submit-btn">Submit</button></div><p class="violation-error"></p><div class="violation-warning"><p>All violations are being recorded.</p></div></div>',this.addProctoringStyles();var e=t.querySelector(".violation-submit-btn"),i=t.querySelector(".violation-code-input");e.addEventListener("click",this.handleCodeSubmit.bind(this)),i.addEventListener("keypress",function(t){"Enter"===t.key&&this.handleCodeSubmit()}.bind(this)),t.addEventListener("click",(function(e){e.target===t&&(e.preventDefault(),e.stopPropagation())})),document.body.appendChild(t),this.violationOverlay=t}addProctoringStyles(){var t="mock-exam-proctoring-styles";if(!document.getElementById(t)){var e=document.createElement("style");e.id=t,e.textContent=".proctoring-violation-overlay{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:999999;justify-content:center;align-items:center;font-family:sans-serif}.violation-container{background:#1a1a1a;border:2px solid #f44;border-radius:12px;padding:40px;max-width:500px;width:90%;text-align:center;color:#fff}.violation-icon{font-size:64px;margin-bottom:20px}.violation-title{color:#f44;font-size:28px;margin:0 0 15px}.violation-message{color:#ccc;margin:0 0 30px}.violation-details{background:#0a0a0a;border-radius:8px;padding:20px;margin-bottom:25px}.violation-timer{color:#f44;font-size:20px;font-weight:700;margin:0 0 15px}.violation-instruction{color:#fff;margin:0}.violation-input-group{display:flex;gap:10px;margin-bottom:20px}.violation-code-input{flex:1;padding:15px;font-size:16px;border:2px solid #333;border-radius:8px;background:#0a0a0a;color:#fff;outline:0}.violation-code-input:focus{border-color:#f44}.violation-code-input:disabled{opacity:.5;cursor:not-allowed}.violation-submit-btn{padding:15px 30px;font-size:16px;font-weight:600;background:#f44;color:#fff;border:none;border-radius:8px;cursor:pointer}.violation-submit-btn:hover:not(:disabled){background:#f66}.violation-submit-btn:disabled{opacity:.5;cursor:not-allowed}.violation-error{display:none;color:#f66;font-size:14px;margin:10px 0;padding:12px;background:rgba(255,68,68,.1);border-radius:6px}.violation-warning{margin-top:25px;padding-top:25px;border-top:1px solid #333}.violation-warning p{color:#888;font-size:12px;margin:5px 0}",document.head.appendChild(e)}}getViolationCount(){return this.violations.length}exportViolationsReport(){return{totalViolations:this.violations.length,violations:this.violations,exportTime:(new Date).toISOString(),exportTimeString:(new Date).toLocaleString()}}}function n(t){t&&(!function(){var t="mock-exam-highlight-styles";if(!document.getElementById(t)){var e=document.createElement("style");e.id=t,e.textContent=".highlight{background-color:#ffeb3b;cursor:pointer}",document.head.appendChild(e)}}(),t.addEventListener("mouseup",(function(){var t=window.getSelection();if(0!==(t.toString()||"").trim().length)try{var e=t.getRangeAt(0),i=document.createElement("span");i.className="highlight",e.surroundContents(i),t.removeAllRanges()}catch(t){}})),t.addEventListener("click",(function(t){if(t.target.classList&&t.target.classList.contains("highlight")){for(var e=t.target.parentNode;t.target.firstChild;)e.insertBefore(t.target.firstChild,t.target);e.removeChild(t.target)}})))}var o={_opts:null,_proctoring:null,_studentName:null,init:function(a){var r=this;r._opts=a||{};var l=r._opts,s=l.welcomeScreenId||"welcomeScreen",d=l.examContainerId||"examContainer",c=l.studentNameInputId||"studentName",u=l.passwordInputId||"examPassword",m=l.welcomeErrorId||"welcomeError",h=l.startButtonSelector||".start-button",v=l.studentInfoId||"studentInfo",p=l.passageContentId||"passageContent",f=l.submitButtonId||"submitBtn",y=document.getElementById(s),g=document.getElementById(d),b=document.getElementById(c),x=document.getElementById(u),w=document.getElementById(m),S=document.getElementById(v),E=document.getElementById(p),C=document.getElementById(f);if(!y||!g)return r;var k=null!=l.password?e(l.password):void 0,F=e(void 0!==l.reactivationCode?l.reactivationCode:"1234");function T(e){w&&(w.textContent=e,w.style.display="block"),!1!==l.invalidPasswordAlert&&t.alert(e)}function q(){w&&(w.textContent="",w.style.display="none")}r._proctoring=new i({reactivationCode:F,codeTimeout:l.codeTimeout||6e4,onViolation:l.onViolation||null,onReactivated:l.onReactivated||null,onTimeout:l.onProctoringTimeout||null});var I=y.querySelector(h);function D(){var e=function(t,e){var i={},n=[];document.querySelectorAll(".question-number").forEach((function(t){var e=(t.textContent||"").trim().replace(/^\D+/,"");e&&-1===n.indexOf(e)&&n.push(e)})),document.querySelectorAll("[data-question]").forEach((function(t){var e=t.getAttribute("data-question");e&&-1===n.indexOf(e)&&n.push(e)})),n.forEach((function(t){i[t]="(not answered)"})),document.querySelectorAll(".question-item").forEach((function(t){var e=t.querySelector(".question-number"),n=t.querySelector(".tf-option.selected");if(e&&n){var o=(e.textContent||"").trim().replace(/^\D+/,"");o&&(i[o]=(n.textContent||"").trim()||"(not answered)")}}));var o={};document.querySelectorAll('input[type="checkbox"][data-question]:checked').forEach((function(t){var e=t.getAttribute("data-question");e&&(o[e]=(o[e]||[]).concat(t.value||""))})),Object.keys(o).forEach((function(t){i[t]=o[t].sort().join(", ")||"(not answered)"})),document.querySelectorAll('input[data-question]:not([type="checkbox"])').forEach((function(t){var e=t.getAttribute("data-question");e&&(i[e]=(t.value||"").trim()||"(not answered)")})),document.querySelectorAll("select[data-question]").forEach((function(t){var e=t.getAttribute("data-question");e&&(i[e]=(t.value||"").trim()||"(not answered)")}));var a=e?e.getViolationCount():0;return{studentName:t||"Student",answers:i,violationCount:a}}(r._studentName,r._proctoring),i=document.getElementById("resultsModal"),n=document.getElementById("answerSheet");if(i&&n){var o=["Student: "+e.studentName,"Date: "+(new Date).toLocaleDateString(),"Time: "+(new Date).toLocaleTimeString(),"Violations: "+e.violationCount,"","Answers:"];Object.keys(e.answers).sort((function(t,e){return Number(t)-Number(e)||String(t).localeCompare(String(e))})).forEach((function(t){o.push(t+". "+(e.answers[t]||"(not answered)"))})),n.textContent=o.join("\n"),i.style.display="flex"}new Promise((function(e,i){if(void 0===t.jspdf){var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",n.onload=function(){e()},n.onerror=function(){i(new Error("Failed to load jsPDF"))},document.head.appendChild(n)}else e()})).then((function(){!function(e,i){var n=t.jspdf;if(!n||!n.jsPDF)return Promise.reject(new Error("jsPDF not loaded"));var o=new(0,n.jsPDF),a=o.internal.pageSize.getWidth(),r=20,l=20;o.setFontSize(20),o.setTextColor(220,38,38),o.text(i.testTitle||"Mock Exam",a/2,l,{align:"center"}),l+=12,o.setFontSize(10),o.setTextColor(0,0,0),o.text("Answer Sheet",a/2,l,{align:"center"}),l+=15,o.text("Student: "+(e.studentName||"â€”"),r,l),l+=7,o.text("Date: "+(new Date).toLocaleDateString(),r,l),l+=7,o.text("Time: "+(new Date).toLocaleTimeString(),r,l),l+=7,i.testCode&&(o.text("Test Code: "+i.testCode,r,l),l+=7),o.text("Violations: "+(e.violationCount||0),r,l),l+=12;var s=Object.keys(e.answers).filter((function(t){return""!==t})).sort((function(t,e){return Number(t)-Number(e)||String(t).localeCompare(String(e))}));o.setFontSize(12),o.setTextColor(220,38,38),o.text("Answers",r,l),l+=10,o.setFontSize(10),o.setTextColor(0,0,0),s.forEach((function(t){l>270&&(o.addPage(),l=20),o.text(t+". "+(e.answers[t]||"(not answered)"),25,l),l+=6}));var d=(e.studentName||"Student").replace(/\s+/g,"_").replace(/[^\w\-_]/g,""),c=(i.pdfFileNamePrefix||"MockExam_AnswerSheet")+"_"+d+"_"+Date.now()+".pdf";o.save(c)}(e,{testTitle:l.testTitle||"Mock Exam",testCode:l.testCode||"",pdfFileNamePrefix:l.pdfFileNamePrefix||"MockExam_AnswerSheet"}),r._proctoring.isActive&&r._proctoring.stop(),"function"==typeof l.onPDFGenerated&&l.onPDFGenerated({studentName:e.studentName,violationCount:e.violationCount,answers:e.answers,timestamp:(new Date).toISOString()})})).catch((function(t){console.error("PDF generation failed:",t),r._proctoring.isActive&&r._proctoring.stop()}))}return I&&I.addEventListener("click",(function(){q();var t=b?(b.value||"").trim():"",e=x?(x.value||"").trim():"",i=k;return t?t.length<2?(T("Name must be at least 2 characters."),void(b&&b.focus())):null!=i&&""!==String(i).trim()&&e!==String(i).trim()?(T("Invalid password. You cannot start the exam."),void(x&&(x.value="",x.focus()))):(q(),r._studentName=t,y.style.display="none",g.style.display="flex",S&&(S.textContent="Student: "+t),document.documentElement.requestFullscreen?document.documentElement.requestFullscreen().catch((function(){})):document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(),r._proctoring.start(),n(E||document.body),void("function"==typeof l.onExamStart&&l.onExamStart({studentName:t,timestamp:(new Date).toISOString()}))):(T("Please enter your name."),void(b&&b.focus()))})),C&&C.addEventListener("click",(function(t){t.preventDefault(),D()})),t.MockExamSystem=o,t.ProctoringSystem=i,r}};t.MockExamSystem=o,t.ProctoringSystem=i,"undefined"!=typeof module&&module.exports&&(module.exports={MockExamSystem:o,ProctoringSystem:i})}("undefined"!=typeof window?window:globalThis);
