!function(t){"use strict";function e(e){if("string"!=typeof e)return e;if("base64:"===e.slice(0,7))try{return t.atob(e.slice(7))}catch(i){}return e}class i{constructor(t={}){this.reactivationCode=t.reactivationCode||"1234",this.codeTimeout=t.codeTimeout||6e4,this.onViolation=t.onViolation||null,this.onReactivated=t.onReactivated||null,this.onTimeout=t.onTimeout||null,this.violations=[],this.isViolated=!1,this.isFullScreen=!1,this.violationStartTime=null,this.timeoutTimer=null,this.isActive=!1,this.violationOverlay=null,this.init()}init(){this.createViolationOverlay(),this.attachEventListeners()}start(){this.isActive=!0,this.enterFullScreen()}stop(){this.isActive=!1,this.exitFullScreen()}enterFullScreen(){let t=document.documentElement;t.requestFullscreen?t.requestFullscreen().catch(function(){}):t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()}exitFullScreen(){document.exitFullscreen?document.exitFullscreen().catch(function(){}):document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}isInFullScreen(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}attachEventListeners(){window.addEventListener("blur",this.handleWindowBlur.bind(this)),window.addEventListener("focus",this.handleWindowFocus.bind(this)),document.addEventListener("visibilitychange",this.handleVisibilityChange.bind(this)),document.addEventListener("fullscreenchange",this.handleFullScreenChange.bind(this)),document.addEventListener("webkitfullscreenchange",this.handleFullScreenChange.bind(this)),document.addEventListener("msfullscreenchange",this.handleFullScreenChange.bind(this)),document.addEventListener("keydown",this.handleKeyDown.bind(this)),document.addEventListener("contextmenu",this.handleContextMenu.bind(this)),document.addEventListener("copy",this.handleCopy.bind(this)),document.addEventListener("paste",this.handlePaste.bind(this)),document.addEventListener("cut",this.handleCut.bind(this))}handleWindowBlur(){this.isActive&&!this.isViolated&&(this.recordViolation("Window focus lost"),this.showViolation("Window Focus Lost","You switched to another window or application"))}handleWindowFocus(){}handleVisibilityChange(){this.isActive&&!this.isViolated&&document.hidden&&(this.recordViolation("Tab switched"),this.showViolation("Tab Switch Detected","You switched to another browser tab"))}handleFullScreenChange(){if(!this.isActive)return;let t=this.isInFullScreen();t||this.isViolated||(this.recordViolation("Exited full screen"),this.showViolation("Full Screen Exited","You exited full screen mode")),this.isFullScreen=t}handleKeyDown(t){if(!this.isActive)return;let e=[t.altKey&&"Tab"===t.key,t.ctrlKey&&t.shiftKey&&"Escape"===t.key,t.metaKey&&"Tab"===t.key,"F11"===t.key,"F12"===t.key,t.ctrlKey&&"w"===t.key,t.ctrlKey&&"t"===t.key,t.ctrlKey&&t.shiftKey&&"N"===t.key,t.altKey&&"F4"===t.key,t.ctrlKey&&t.shiftKey&&("I"===t.key||"J"===t.key||"C"===t.key),t.ctrlKey&&("u"===t.key||"U"===t.key),t.metaKey&&t.altKey&&("I"===t.key||"J"===t.key||"U"===t.key||"C"===t.key)];if(e.some(function(t){return t}))return t.preventDefault(),t.stopPropagation(),!1}handleContextMenu(t){if(this.isActive)return t.preventDefault(),!1}handleCopy(t){if(this.isActive)return t.preventDefault(),!1}handlePaste(t){if(this.isActive)return t.preventDefault(),!1}handleCut(t){if(this.isActive)return t.preventDefault(),!1}recordViolation(t){let e={type:t,timestamp:new Date().toISOString(),timeString:new Date().toLocaleString()};this.violations.push(e),this.onViolation&&this.onViolation(e,this.violations)}showViolation(t,e){if(!this.isViolated){this.isViolated=!0,this.violationStartTime=Date.now(),document.body.style.backgroundColor="#000",document.body.style.color="#fff",this.violationOverlay.style.display="flex";var i=this.violationOverlay.querySelector(".violation-title"),n=this.violationOverlay.querySelector(".violation-message"),o=this.violationOverlay.querySelector(".violation-code-input"),a=this.violationOverlay.querySelector(".violation-timer");i.textContent=t,n.textContent=e,o.value="",o.focus(),this.startCountdown(a)}}hideViolation(){this.isViolated=!1,this.violationStartTime=null,this.timeoutTimer&&(clearInterval(this.timeoutTimer),this.timeoutTimer=null),document.body.style.backgroundColor="",document.body.style.color="",this.violationOverlay.style.display="none",this.isActive&&this.enterFullScreen()}startCountdown(t){var e=this;function i(){if(!e.isViolated){e.timeoutTimer&&(clearInterval(e.timeoutTimer),e.timeoutTimer=null);return}var i=Math.max(0,e.codeTimeout-(Date.now()-e.violationStartTime));t.textContent="Time remaining: "+Math.ceil(i/1e3)+"s",i<=0&&(clearInterval(e.timeoutTimer),e.handleTimeout())}i(),this.timeoutTimer=setInterval(i,100)}handleTimeout(){var t=this.violationOverlay.querySelector(".violation-error"),e=this.violationOverlay.querySelector(".violation-code-input"),i=this.violationOverlay.querySelector(".violation-submit-btn");t.textContent="Time expired! Test session terminated.",t.style.display="block",e.disabled=!0,i.disabled=!0,this.isActive=!1,this.onTimeout&&this.onTimeout(this.violations)}verifyCode(t){return t===this.reactivationCode}handleCodeSubmit(){var t=this.violationOverlay.querySelector(".violation-code-input"),e=this.violationOverlay.querySelector(".violation-error"),i=(t.value||"").trim();this.verifyCode(i)?(e.style.display="none",this.hideViolation(),this.onReactivated&&this.onReactivated(this.violations)):(e.textContent="Invalid reactivation code. Please try again.",e.style.display="block",t.value="",t.focus())}createViolationOverlay(){var t=document.createElement("div");t.className="proctoring-violation-overlay",t.innerHTML='<div class="violation-container"><div class="violation-icon">!</div><h2 class="violation-title">Violation Detected</h2><p class="violation-message">A proctoring violation has been detected.</p><div class="violation-details"><p class="violation-timer">Time remaining: 60s</p><p class="violation-instruction">Enter the reactivation code to continue:</p></div><div class="violation-input-group"><input type="password" class="violation-code-input" placeholder="Enter reactivation code" maxlength="20" autocomplete="off" /><button class="violation-submit-btn">Submit</button></div><p class="violation-error"></p><div class="violation-warning"><p>All violations are being recorded.</p></div></div>',this.addProctoringStyles();var e=t.querySelector(".violation-submit-btn"),i=t.querySelector(".violation-code-input");e.addEventListener("click",this.handleCodeSubmit.bind(this)),i.addEventListener("keypress",(function(t){"Enter"===t.key&&this.handleCodeSubmit()}).bind(this)),t.addEventListener("click",function(e){e.target===t&&(e.preventDefault(),e.stopPropagation())}),document.body.appendChild(t),this.violationOverlay=t}addProctoringStyles(){var t="mock-exam-proctoring-styles";if(!document.getElementById(t)){var e=document.createElement("style");e.id=t,e.textContent=".proctoring-violation-overlay{display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;background:#000;z-index:999999;justify-content:center;align-items:center;font-family:sans-serif}.violation-container{background:#1a1a1a;border:2px solid #f44;border-radius:12px;padding:40px;max-width:500px;width:90%;text-align:center;color:#fff}.violation-icon{font-size:64px;margin-bottom:20px}.violation-title{color:#f44;font-size:28px;margin:0 0 15px}.violation-message{color:#ccc;margin:0 0 30px}.violation-details{background:#0a0a0a;border-radius:8px;padding:20px;margin-bottom:25px}.violation-timer{color:#f44;font-size:20px;font-weight:700;margin:0 0 15px}.violation-instruction{color:#fff;margin:0}.violation-input-group{display:flex;gap:10px;margin-bottom:20px}.violation-code-input{flex:1;padding:15px;font-size:16px;border:2px solid #333;border-radius:8px;background:#0a0a0a;color:#fff;outline:0}.violation-code-input:focus{border-color:#f44}.violation-code-input:disabled{opacity:.5;cursor:not-allowed}.violation-submit-btn{padding:15px 30px;font-size:16px;font-weight:600;background:#f44;color:#fff;border:none;border-radius:8px;cursor:pointer}.violation-submit-btn:hover:not(:disabled){background:#f66}.violation-submit-btn:disabled{opacity:.5;cursor:not-allowed}.violation-error{display:none;color:#f66;font-size:14px;margin:10px 0;padding:12px;background:rgba(255,68,68,.1);border-radius:6px}.violation-warning{margin-top:25px;padding-top:25px;border-top:1px solid #333}.violation-warning p{color:#888;font-size:12px;margin:5px 0}",document.head.appendChild(e)}}getViolationCount(){return this.violations.length}exportViolationsReport(){return{totalViolations:this.violations.length,violations:this.violations,exportTime:new Date().toISOString(),exportTimeString:new Date().toLocaleString()}}}var n={_opts:null,_proctoring:null,_studentName:null,init:function(o){var a=this;a._opts=o||{};var r=a._opts,s=r.welcomeScreenId||"welcomeScreen",l=r.examContainerId||"examContainer",d=r.studentNameInputId||"studentName",c=r.passwordInputId||"examPassword",u=r.welcomeErrorId||"welcomeError",h=r.startButtonSelector||".start-button",v=r.studentInfoId||"studentInfo",m=r.passageContentId||"passageContent",p=r.submitButtonId||"submitBtn",f=document.getElementById(s),y=document.getElementById(l),g=document.getElementById(d),x=document.getElementById(c),b=document.getElementById(u),$=document.getElementById(v),w=document.getElementById(m),S=document.getElementById(p);if(!f||!y)return a;var E=null!=r.password?e(r.password):void 0,C=e(void 0!==r.reactivationCode?r.reactivationCode:"1234");function k(e){b&&(b.textContent=e,b.style.display="block"),!1!==r.invalidPasswordAlert&&t.alert(e)}function F(){b&&(b.textContent="",b.style.display="none")}a._proctoring=new i({reactivationCode:C,codeTimeout:r.codeTimeout||6e4,onViolation:r.onViolation||null,onReactivated:r.onReactivated||null,onTimeout:r.onProctoringTimeout||null});var T=f.querySelector(h);return T&&T.addEventListener("click",function t(){F();var e,i=g?(g.value||"").trim():"",n=x?(x.value||"").trim():"",o=E;if(!i){k("Please enter your name."),g&&g.focus();return}if(i.length<2){k("Name must be at least 2 characters."),g&&g.focus();return}if(null!=o&&""!==String(o).trim()&&n!==String(o).trim()){k("Invalid password. You cannot start the exam."),x&&(x.value="",x.focus());return}F(),a._studentName=i,f.style.display="none",y.style.display="flex",$&&($.textContent="Student: "+i),document.documentElement.requestFullscreen?document.documentElement.requestFullscreen().catch(function(){}):document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(),a._proctoring.start(),(e=w||document.body)&&(function t(){var e="mock-exam-highlight-styles";if(!document.getElementById(e)){var i=document.createElement("style");i.id=e,i.textContent=".highlight{background-color:#ffeb3b;cursor:pointer}",document.head.appendChild(i)}}(),e.addEventListener("mouseup",function(){var t=window.getSelection();if(0!==(t.toString()||"").trim().length)try{var e=t.getRangeAt(0),i=document.createElement("span");i.className="highlight",e.surroundContents(i),t.removeAllRanges()}catch(n){}}),e.addEventListener("click",function(t){if(t.target.classList&&t.target.classList.contains("highlight")){for(var e=t.target.parentNode;t.target.firstChild;)e.insertBefore(t.target.firstChild,t.target);e.removeChild(t.target)}})),"function"==typeof r.onExamStart&&r.onExamStart({studentName:i,timestamp:new Date().toISOString()})}),S&&S.addEventListener("click",function(e){e.preventDefault(),function e(){var i,n,o,s,l=(i=a._studentName,n=a._proctoring,o={},document.querySelectorAll(".question-item").forEach(function(t){var e=t.querySelector(".question-number"),i=t.querySelector(".tf-option.selected");if(e&&i){var n=(e.textContent||"").trim().replace(/^\D+/,"");n&&(o[n]=(i.textContent||"").trim()||"(not answered)")}}),s={},document.querySelectorAll('input[type="checkbox"][data-question]:checked').forEach(function(t){var e=t.getAttribute("data-question");e&&(s[e]=(s[e]||[]).concat(t.value||""))}),Object.keys(s).forEach(function(t){o[t]=s[t].sort().join(", ")||"(not answered)"}),document.querySelectorAll('input[data-question]:not([type="checkbox"])').forEach(function(t){var e=t.getAttribute("data-question");e&&!o[e]&&(o[e]=(t.value||"").trim()||"(not answered)")}),document.querySelectorAll("select[data-question]").forEach(function(t){var e=t.getAttribute("data-question");e&&(o[e]=(t.value||"").trim()||"(not answered)")}),{studentName:i||"Student",answers:o,violationCount:n?n.getViolationCount():0}),d=document.getElementById("resultsModal"),c=document.getElementById("answerSheet");if(d&&c){var u=["Student: "+l.studentName,"Date: "+new Date().toLocaleDateString(),"Time: "+new Date().toLocaleTimeString(),"Violations: "+l.violationCount,"","Answers:"];Object.keys(l.answers).sort(function(t,e){return Number(t)-Number(e)||String(t).localeCompare(String(e))}).forEach(function(t){u.push(t+". "+(l.answers[t]||"(not answered)"))}),c.textContent=u.join("\n"),d.style.display="flex"}new Promise(function(e,i){if(void 0!==t.jspdf){e();return}var n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js",n.onload=function(){e()},n.onerror=function(){i(Error("Failed to load jsPDF"))},document.head.appendChild(n)}).then(function(){(function e(i,n){var o=t.jspdf;if(!o||!o.jsPDF)return Promise.reject(Error("jsPDF not loaded"));var a=new o.jsPDF,r=a.internal.pageSize.getWidth(),s=20;a.setFontSize(20),a.setTextColor(220,38,38),a.text(n.testTitle||"Mock Exam",r/2,s,{align:"center"}),s+=12,a.setFontSize(10),a.setTextColor(0,0,0),a.text("Answer Sheet",r/2,s,{align:"center"}),s+=15,a.text("Student: "+(i.studentName||"â€”"),20,s),s+=7,a.text("Date: "+new Date().toLocaleDateString(),20,s),s+=7,a.text("Time: "+new Date().toLocaleTimeString(),20,s),s+=7,n.testCode&&(a.text("Test Code: "+n.testCode,20,s),s+=7),a.text("Violations: "+(i.violationCount||0),20,s),s+=12;var l=Object.keys(i.answers).filter(function(t){return""!==t}).sort(function(t,e){return Number(t)-Number(e)||String(t).localeCompare(String(e))});a.setFontSize(12),a.setTextColor(220,38,38),a.text("Answers",20,s),s+=10,a.setFontSize(10),a.setTextColor(0,0,0),l.forEach(function(t){s>270&&(a.addPage(),s=20),a.text(t+". "+(i.answers[t]||"(not answered)"),25,s),s+=6});var d=(i.studentName||"Student").replace(/\s+/g,"_").replace(/[^\w\-_]/g,""),c=(n.pdfFileNamePrefix||"MockExam_AnswerSheet")+"_"+d+"_"+Date.now()+".pdf";return a.save(c),a})(l,{testTitle:r.testTitle||"Mock Exam",testCode:r.testCode||"",pdfFileNamePrefix:r.pdfFileNamePrefix||"MockExam_AnswerSheet"}),a._proctoring.isActive&&a._proctoring.stop(),"function"==typeof r.onPDFGenerated&&r.onPDFGenerated({studentName:l.studentName,violationCount:l.violationCount,answers:l.answers,timestamp:new Date().toISOString()})}).catch(function(t){console.error("PDF generation failed:",t),a._proctoring.isActive&&a._proctoring.stop()})}()}),t.MockExamSystem=n,t.ProctoringSystem=i,a}};t.MockExamSystem=n,t.ProctoringSystem=i,"undefined"!=typeof module&&module.exports&&(module.exports={MockExamSystem:n,ProctoringSystem:i})}("undefined"!=typeof window?window:globalThis);
